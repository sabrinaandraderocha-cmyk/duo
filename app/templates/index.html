{% extends "base.html" %}

{% block title %}Duo ‚Ä¢ Home{% endblock %}

{% block content %}
<div class="wrap">

  <div style="margin-bottom: 30px;">
    <h2 style="font-size: 28px; margin-bottom: 8px; color: var(--text);">
      {{ saudacao }}, {{ user.name }}!
    </h2>
    
    {% if has_today %}
      {% set filled_count = 0 %}
      {% if timeline[0].me.filled %}{% set filled_count = filled_count + 1 %}{% endif %}
      {% if timeline[0].par.filled %}{% set filled_count = filled_count + 1 %}{% endif %}
      
      <div class="synergy-bar-container">
        <div class="synergy-label">
          Sinergia do dia: <strong>{{ (filled_count / 2 * 100) | int }}%</strong>
          {% if filled_count == 2 %}üéâ{% endif %}
        </div>
        <div class="synergy-track">
          <div class="synergy-fill" style="width: {{ (filled_count / 2 * 100) }}%;"></div>
        </div>
      </div>
    {% endif %}
  </div>

  <div class="card-title" style="margin-bottom: 20px;">
    <h2>Registro do Momento ‚úçÔ∏è</h2>
    <p class="muted">Como voc√™s viveram o dia de hoje?</p>
  </div>

  <div class="journal-grid">

    <div class="journal-card">
      <div class="card-header">
        <div class="avatar">{{ user.name[0] | upper }}</div>
        <div class="user-name">Minha Parte</div>
      </div>

      <form action="/save_side" method="post">
        <input type="hidden" name="side" value="self">
        
        <div class="input-group">
          <label class="input-label">‚ú® Como estou hoje</label>
          <input 
            type="text" 
            name="mood" 
            placeholder="{{ ph_humor }}" 
            value="{{ timeline[0].me.mood if has_today else '' }}"
            autocomplete="off"
          >
        </div>

        <div class="input-group">
          <label class="input-label">‚ù§Ô∏è Momento Especial</label>
          <textarea 
            name="moment_special" 
            placeholder="{{ ph_momento }}"
          >{{ timeline[0].me.moment_special if has_today else '' }}</textarea>
        </div>

        <div class="input-group">
          <label class="input-label">üéÅ Gesto de amor do par</label>
          <input 
            type="text" 
            name="love_action" 
            placeholder="O que ele(a) fez que voc√™ amou?" 
            value="{{ timeline[0].me.love_action if has_today else '' }}"
          >
        </div>

        <div class="input-group">
          <label class="input-label">üå°Ô∏è Climinha (Opcional)</label>
          <div class="mood-grid">
            {% for key, label in diary_tags.items() %}
            <label>
              <input type="checkbox" name="tags" value="{{ key }}" 
                {% if has_today and key in timeline[0].me.tags %}checked{% endif %}>
              <span class="mood-tag">{{ label }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        
        <div class="save-area">
          <button type="submit" class="btn primary" style="width: 100%">
            Salvar meu dia
          </button>
        </div>
      </form>
    </div>

    <div class="journal-card" style="background: #f8fafc; border-style: dashed;">
      <div class="card-header">
        <div class="avatar" style="background: #e2e8f0; color: #64748b;">
          {{ partner_name[0] | upper if partner_name else '?' }}
        </div>
        <div class="user-name">{{ partner_name or 'Seu Par' }}</div>
      </div>

      {% if has_today and timeline[0].par.filled %}
        <div class="input-group">
          <label class="input-label">‚ú® Como est√° hoje</label>
          <div class="read-only-box">{{ timeline[0].par.mood }}</div>
        </div>
        <div class="input-group">
          <label class="input-label">‚ù§Ô∏è Momento Especial</label>
          <p class="read-text">{{ timeline[0].par.moment_special }}</p>
        </div>
        
        {% if timeline[0].par.tags %}
         <div class="mood-grid">
           {% for t in timeline[0].par.tags %}
             <span class="mood-tag" style="background: #fff; cursor: default;">
               {{ diary_tags.get(t, t) }}
             </span>
           {% endfor %}
         </div>
        {% endif %}

      {% else %}
        <div style="text-align: center; padding: 40px 0; color: var(--muted);">
          <div style="font-size: 40px; margin-bottom: 10px;">‚è≥</div>
          <p>Aguardando {{ partner_name }} escrever...</p>
        </div>
      {% endif %}
    </div>

  </div> </div>
{% endblock %}
