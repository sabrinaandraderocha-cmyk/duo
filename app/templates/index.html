{% extends "base.html" %}

{% block title %}Duo â€¢ Home{% endblock %}

{% block content %}
<div class="wrap">

  <div style="margin-bottom: 30px;">
    <h2 style="font-size: 28px; margin-bottom: 8px; color: var(--text);">
      {{ saudacao }}, {{ user.name }}!
    </h2>
    
    {% if has_today %}
      <div class="synergy-bar-container">
        <div class="synergy-label">
          Sinergia do dia: <strong>{{ synergy_percent }}%</strong>
          {% if synergy_percent == 100 %}ğŸ‰{% endif %}
        </div>
        <div class="synergy-track">
          <div class="synergy-fill" style="width: {{ synergy_percent }}%;"></div>
        </div>
      </div>
    {% endif %}
  </div>

  <div class="card-title" style="margin-bottom: 20px;">
    <h2>Novo Registro âœï¸</h2>
    <p class="muted">Adicione um novo momento ao seu dia.</p>
  </div>

  <div class="journal-grid">

    <div class="journal-card card-me">
      <div class="card-header">
        <div class="avatar avatar-me">{{ user.name[0] | upper }}</div>
        <div class="user-name">{{ user.name }}</div>
      </div>

      <form action="/save_side" method="post">
        <input type="hidden" name="side" value="self">
        
        <div class="input-group">
          <label class="input-label">âœ¨ Como estou hoje</label>
          <input type="text" name="mood" placeholder="{{ ph_humor }}" autocomplete="off">
        </div>

        <div class="input-group">
          <label class="input-label">â¤ï¸ Momento Especial</label>
          <textarea name="moment_special" placeholder="{{ ph_momento }}"></textarea>
        </div>

        <div class="input-group">
          <label class="input-label">ğŸ­ Personagem do dia</label>
          <input type="text" name="character" placeholder="Ex: AmÃ©lie, Ted Lasso...">
        </div>

        <div class="input-group">
          <label class="input-label">ğŸµ MÃºsica do dia</label>
          <input type="text" name="music" placeholder="Artista â€” MÃºsica">
        </div>

        <div class="input-group">
          <label class="input-label">ğŸ Gesto de amor do par</label>
          <input type="text" name="love_action" placeholder="O que ele(a) fez que vocÃª amou?">
        </div>

        <div class="input-group">
          <label class="input-label">ğŸŒ¡ï¸ Climinha (Opcional)</label>
          <div class="mood-grid">
            {% for key, label in diary_tags.items() %}
            <label>
              <input type="checkbox" name="tags" value="{{ key }}">
              <span class="mood-tag">{{ label }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        
        <div class="save-area">
          <button type="submit" class="btn primary" style="width: 100%">
            Salvar novo registro
          </button>
        </div>
      </form>
    </div>

    <div class="journal-card card-par">
      <div class="card-header">
        <div class="avatar avatar-par">
          {{ partner_name[0] | upper if partner_name else '?' }}
        </div>
        <div class="user-name">{{ partner_name or 'Seu Par' }}</div>
      </div>

      <div class="waiting-state">
        <div style="font-size: 40px; margin-bottom: 10px;">ğŸ‘‹</div>
        <p>A parte dele(a) aparece na Linha do Tempo abaixo.</p>
      </div>
    </div>

  </div>

  <div class="timeline" style="margin-top: 60px;">
    <h2>Linha do Tempo ğŸ“…</h2>

    {% if not timeline %}
      <div class="empty-state">
        <div class="empty-icon">ğŸ“</div>
        <h3>O diÃ¡rio estÃ¡ comeÃ§ando...</h3>
        <p>Preencha os dados acima para iniciar a histÃ³ria de vocÃªs.</p>
      </div>
    {% else %}
      
      {% for day_data in timeline %}
        <div class="entry">
          <div class="entry-head">
            <strong>ğŸ—“ï¸ {{ day_data.display_date }}</strong>
            <span>Registros</span>
          </div>

          {% for me_entry, par_entry in day_data.rows %}
            <div class="journal-grid" style="margin-top: 0; gap: 24px; margin-bottom: 24px;">
              
              <div style="flex:1">
                {% if me_entry %}
                  <div class="journal-card card-me" style="padding: 16px; min-height: 100%;">
                    <div style="font-size: 13px; color: var(--muted); margin-bottom: 8px;">
                      {{ user.name }} escreveu:
                    </div>
                    <div class="read-text" style="background: var(--accent-light); border:none;">
                      {{ me_entry.moment_special }}
                    </div>
                    {% if me_entry.mood %}
                      <div style="margin-top:8px; font-size:13px; color:var(--muted)">âœ¨ {{ me_entry.mood }}</div>
                    {% endif %}
                    {% if me_entry.character %}
                      <div style="margin-top:4px; font-size:13px; color:var(--muted)">ğŸ­ {{ me_entry.character }}</div>
                    {% endif %}
                    {% if me_entry.music %}
                      <div style="margin-top:4px; font-size:13px; color:var(--muted)">ğŸµ {{ me_entry.music }}</div>
                    {% endif %}
                  </div>
                {% endif %}
              </div>

              <div style="flex:1">
                {% if par_entry %}
                  <div class="journal-card card-par" style="padding: 16px; min-height: 100%;">
                    <div style="font-size: 13px; color: var(--muted); margin-bottom: 8px;">
                      {{ partner_name }} escreveu:
                    </div>
                    <div class="read-text" style="background: #fff; border: 1px solid var(--border);">
                      {{ par_entry.moment_special }}
                    </div>
                    {% if par_entry.mood %}
                      <div style="margin-top:8px; font-size:13px; color:var(--muted)">âœ¨ {{ par_entry.mood }}</div>
                    {% endif %}
                    {% if par_entry.character %}
                      <div style="margin-top:4px; font-size:13px; color:var(--muted)">ğŸ­ {{ par_entry.character }}</div>
                    {% endif %}
                    {% if par_entry.music %}
                      <div style="margin-top:4px; font-size:13px; color:var(--muted)">ğŸµ {{ par_entry.music }}</div>
                    {% endif %}
                  </div>
                {% endif %}
              </div>

            </div>
          {% endfor %}
        </div>
      {% endfor %}

    {% endif %}
  </div>

</div>
{% endblock %}
